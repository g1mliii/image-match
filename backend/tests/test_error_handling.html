<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Handling Test</title>
    <link rel="stylesheet" href="backend/static/styles.css">
</head>
<body>
    <div class="app-container">
        <h1>Error Handling & User Feedback Test</h1>
        
        <div style="padding: 20px;">
            <h2>Test Features:</h2>
            
            <div style="margin: 20px 0;">
                <h3>1. Toast Notifications</h3>
                <button class="btn btn-primary" onclick="testToast('success')">Success Toast</button>
                <button class="btn btn-primary" onclick="testToast('error')">Error Toast</button>
                <button class="btn btn-primary" onclick="testToast('warning')">Warning Toast</button>
                <button class="btn btn-primary" onclick="testToast('info')">Info Toast</button>
            </div>
            
            <div style="margin: 20px 0;">
                <h3>2. Loading Spinner</h3>
                <button class="btn btn-primary" id="testSpinnerBtn" onclick="testSpinner()">Test Loading Spinner</button>
            </div>
            
            <div style="margin: 20px 0;">
                <h3>3. Tooltips</h3>
                <button class="btn btn-secondary" data-tooltip="This is a helpful tooltip that explains what this button does!">Hover for Tooltip</button>
            </div>
            
            <div style="margin: 20px 0;">
                <h3>4. Drag and Drop Feedback</h3>
                <div class="drop-zone" id="testDropZone" style="margin: 20px 0;">
                    <p>Drag files here to test visual feedback</p>
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <h3>5. Progress Bar</h3>
                <button class="btn btn-primary" onclick="testProgress()">Test Progress Bar</button>
                <div id="testProgress" style="display: none; margin-top: 10px;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="testProgressFill"></div>
                    </div>
                    <p id="testProgressText">0%</p>
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <h3>6. Retry Logic</h3>
                <button class="btn btn-primary" onclick="testRetry()">Test Retry with Backoff</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    
    <script>
        // Mock functions for testing
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            const timeout = (type === 'error' || type === 'warning') ? 5000 : 3000;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, timeout);
        }
        
        function testToast(type) {
            const messages = {
                'success': 'Operation completed successfully!',
                'error': 'An error occurred. Please try again.',
                'warning': 'Warning: This action may take some time.',
                'info': 'Processing your request...'
            };
            showToast(messages[type], type);
        }
        
        function showLoadingSpinner(button, show) {
            if (show) {
                if (!button.querySelector('.btn-spinner')) {
                    const spinner = document.createElement('span');
                    spinner.className = 'btn-spinner';
                    button.appendChild(spinner);
                }
                button.classList.add('loading');
            } else {
                const spinner = button.querySelector('.btn-spinner');
                if (spinner) {
                    spinner.remove();
                }
                button.classList.remove('loading');
            }
        }
        
        function testSpinner() {
            const btn = document.getElementById('testSpinnerBtn');
            showLoadingSpinner(btn, true);
            btn.disabled = true;
            
            setTimeout(() => {
                showLoadingSpinner(btn, false);
                btn.disabled = false;
                showToast('Loading complete!', 'success');
            }, 3000);
        }
        
        function testProgress() {
            const progressDiv = document.getElementById('testProgress');
            const progressFill = document.getElementById('testProgressFill');
            const progressText = document.getElementById('testProgressText');
            
            progressDiv.style.display = 'block';
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += 10;
                progressFill.style.width = `${progress}%`;
                progressText.textContent = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    showToast('Progress complete!', 'success');
                    setTimeout(() => {
                        progressDiv.style.display = 'none';
                        progressFill.style.width = '0%';
                        progressText.textContent = '0%';
                    }, 2000);
                }
            }, 300);
        }
        
        async function testRetry() {
            showToast('Testing retry logic with exponential backoff...', 'info');
            
            let attempt = 0;
            const maxRetries = 3;
            const initialDelay = 1000;
            
            async function attemptRequest() {
                attempt++;
                showToast(`Attempt ${attempt}/${maxRetries}...`, 'warning');
                
                await new Promise(resolve => setTimeout(resolve, initialDelay * Math.pow(2, attempt - 1)));
                
                if (attempt < maxRetries) {
                    await attemptRequest();
                } else {
                    showToast('All retry attempts completed!', 'success');
                }
            }
            
            await attemptRequest();
        }
        
        // Initialize tooltips
        document.addEventListener('DOMContentLoaded', () => {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip-popup';
            tooltip.style.display = 'none';
            document.body.appendChild(tooltip);
            
            document.querySelectorAll('[data-tooltip]').forEach(element => {
                element.addEventListener('mouseenter', (e) => {
                    const text = e.target.getAttribute('data-tooltip');
                    if (text) {
                        tooltip.textContent = text;
                        tooltip.style.display = 'block';
                        
                        const rect = e.target.getBoundingClientRect();
                        tooltip.style.top = `${rect.bottom + 10}px`;
                        tooltip.style.left = `${rect.left}px`;
                    }
                });
                
                element.addEventListener('mouseleave', () => {
                    tooltip.style.display = 'none';
                });
            });
            
            // Test drag and drop
            const dropZone = document.getElementById('testDropZone');
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                dropZone.classList.add('drop-success');
                showToast('Files dropped successfully!', 'success');
                setTimeout(() => dropZone.classList.remove('drop-success'), 500);
            });
        });
    </script>
</body>
</html>
