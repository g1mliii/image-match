<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CATALOG MATCH</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-main">
                    <h1>CATALOG MATCH</h1>
                    <p>Find similar products in your historical catalog</p>
                </div>
                <div class="header-actions">
                    <div id="gpuStatus" class="gpu-status" data-tooltip="GPU acceleration status - CLIP AI model performance">
                        <span class="status-icon">âš¡</span>
                        <span class="status-text">Checking GPU...</span>
                    </div>
                    <a href="/catalog-manager" class="btn-link" data-tooltip="View and manage your product catalog, cleanup database">CATALOG â†’</a>
                    <a href="/static/csv-builder.html" class="btn-link" data-tooltip="Open CSV Builder tool to create product metadata files">CSV BUILDER â†’</a>
                </div>
            </div>
        </header>

        <main>
            <!-- Active Catalog Info Bar -->
            <div class="catalog-info-bar" id="catalogInfoBar" style="display: none; padding: 12px 15px; background: #f0f0f0; border: 3px solid #000; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div id="activeCatalogInfo" style="display: flex; align-items: center; gap: 8px;">
                        <strong>ACTIVE CATALOG:</strong> <span id="activeCatalogSummary">Loading...</span>
                        <button class="help-btn" onclick="toggleHelp('catalogInfoHelp')">?</button>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="openCatalogManager()" data-tooltip="Open Catalog Manager to change active snapshots">CHANGE CATALOG</button>
                        <button class="btn" onclick="refreshCatalogInfo()" data-tooltip="Refresh catalog information">â†»</button>
                    </div>
                </div>
                <div class="help-text" id="catalogInfoHelp" style="display: none; margin-top: 15px;">
                    <h4> CATALOG SNAPSHOTS EXPLAINED</h4>
                    <p><strong>What you're seeing:</strong> This shows your currently active catalog - the products that will be used for matching.</p>
                    
                    <p><strong>Historical vs New Products:</strong></p>
                    <ul>
                        <li><strong>Historical:</strong> Your existing product catalog (the reference library)</li>
                        <li><strong>New:</strong> Products added in this session that haven't been saved yet</li>
                    </ul>
                    
                    <p><strong>Snapshots:</strong> Think of snapshots as saved versions of your catalog. You can:</p>
                    <ul>
                        <li>Save the current catalog state as a named snapshot</li>
                        <li>Load a previous snapshot to restore that catalog version</li>
                        <li>Switch between different catalog versions for different matching scenarios</li>
                    </ul>
                    
                    <p><strong>When you see "Loaded from:"</strong> This means you're working with a specific snapshot. Any changes you make won't affect the snapshot until you save again.</p>
                    
                    <p><strong>Workflow:</strong></p>
                    <ol>
                        <li>Upload products and perform matching in the main app</li>
                        <li>Click "CHANGE CATALOG" to open Catalog Manager</li>
                        <li>Save current state as a snapshot or load a different one</li>
                        <li>Return to main app - it automatically updates to show the new catalog</li>
                    </ol>
                    
                    <p><strong>ðŸ’¡ Tip:</strong> Create snapshots for different product lines, seasons, or testing scenarios!</p>
                </div>
            </div>

            <!-- Step 1: Historical Catalog -->
            <section class="section" id="historicalSection">
                <div class="section-header">
                    <span class="step">1</span>
                    <h2>HISTORICAL CATALOG</h2>
                    <div class="mode-toggle" id="historicalModeToggle">
                        <button class="mode-option active" onclick="setMode('historical', 'simple')">SIMPLE</button>
                        <button class="mode-option" onclick="setMode('historical', 'advanced')">ADVANCED</button>
                    </div>
                    <button class="help-btn" onclick="toggleHelp('modeHelp1')">?</button>
                </div>
                <div class="help-text" id="modeHelp1" style="display: none; margin-bottom: 20px;">
                    <p><strong>SIMPLE MODE vs ADVANCED MODE:</strong></p>
                    <p><strong>Simple Mode:</strong> Upload images â†’ Visual similarity matching. Fast and easy for quick comparisons.</p>
                    <p><strong>Advanced Mode:</strong> Upload CSV with metadata (required) + optionally images:</p>
                    <p>&nbsp;&nbsp;â€¢ <strong>CSV only:</strong> Metadata analysis (SKU matching, price trends, performance reports)</p>
                    <p>&nbsp;&nbsp;â€¢ <strong>CSV + Images:</strong> Visual matching + Metadata analysis (full business intelligence)</p>
                    <p><strong>Recommendation:</strong> Start with Simple Mode to test. Use Advanced Mode for production workflows with analytics and reporting.</p>
                </div>
                
                <!-- Catalog Loading Options -->
                <div class="catalog-options" id="catalogOptions" style="display: none; margin-bottom: 20px; padding: 15px; border: 2px solid #000; background: #f9f9f9;">
                    <div class="catalog-stats" style="margin-bottom: 15px;">
                        <strong>EXISTING CATALOG:</strong> <span id="existingCatalogStats">Loading...</span>
                        <a href="/catalog-manager" style="margin-left: 10px; font-size: 0.9em;">MANAGE â†’</a>
                    </div>
                    <div class="catalog-radio-options">
                        <label style="display: block; margin: 8px 0; cursor: pointer;">
                            <input type="radio" name="catalogLoadOption" value="use_existing" checked>
                            <strong>Use existing catalog</strong> - Skip upload, use saved data
                        </label>
                        <label style="display: block; margin: 8px 0; cursor: pointer;">
                            <input type="radio" name="catalogLoadOption" value="add_to_existing">
                            <strong>Add to existing catalog</strong> - Upload new products, merge with existing
                        </label>
                        <label style="display: block; margin: 8px 0; cursor: pointer;">
                            <input type="radio" name="catalogLoadOption" value="replace">
                            <strong>Replace catalog</strong> - Clear all and upload fresh
                        </label>
                    </div>
                </div>

                <div class="upload-box">
                    <div class="info">
                        <div class="info-header">
                            <strong>TIP:</strong> Put all category folders (placemats, dinnerware, etc.) inside ONE parent folder, then upload that parent folder
                            <button class="help-btn" onclick="toggleHelp('uploadHelp1')">?</button>
                        </div>
                        <div class="help-text" id="uploadHelp1" style="display: none; margin-top: 15px;">
                            <p><strong>HOW TO ORGANIZE YOUR FOLDERS:</strong></p>
                            <p>1. Create a main folder (e.g., "historical-products")</p>
                            <p>2. Inside it, create subfolders for each category:</p>
                            <p>&nbsp;&nbsp;&nbsp;â€¢ placemats/</p>
                            <p>&nbsp;&nbsp;&nbsp;â€¢ dinnerware/</p>
                            <p>&nbsp;&nbsp;&nbsp;â€¢ glassware/</p>
                            <p>3. Put product images in their category folders</p>
                            <p>4. Upload the main "historical-products" folder</p>
                            <p><strong>NOTE:</strong> You can only upload ONE folder at a time. Make sure all your categories are inside it!</p>
                        </div>
                    </div>
                    
                    <div class="drop-zone" id="historicalDropZone">
                        <p>DROP ONE FOLDER WITH ALL CATEGORIES</p>
                        <button class="btn" id="historicalBrowseBtn">BROWSE</button>
                        <input type="file" id="historicalInput" webkitdirectory directory multiple hidden>
                    </div>
                    
                    <div class="file-info" id="historicalInfo"></div>
                    
                    <div class="csv-box advanced" id="historicalCsvBox" style="display: none;">
                        <div class="csv-header">
                            <label>ADVANCED MODE: ADD PRODUCT DETAILS</label>
                            <button class="help-btn" onclick="toggleHelp('advancedHelp1')">?</button>
                        </div>
                        <div class="help-text" id="advancedHelp1" style="display: none; margin-bottom: 20px;">
                            <p><strong>FULL FEATURE SET:</strong></p>
                            <p><strong>Price Tracking:</strong> Upload historical prices to see trend charts (up/down/stable), min/max/average prices, and price change analysis over time.</p>
                            <p><strong>Sales Analytics:</strong> Track sales volume, page views, conversion rates, and revenue. See performance trends and identify top performers.</p>
                            <p><strong>SKU Management:</strong> Assign unique SKUs to products for inventory tracking and cross-referencing with your systems.</p>
                            <p><strong>Product Names:</strong> Add descriptive names for better organization and reporting.</p>
                            <p><strong>Detailed Reports:</strong> Export comprehensive CSV reports with all data, charts, and analytics for further analysis.</p>
                            <p><strong>Visual Charts:</strong> Interactive sparklines and detailed charts show trends at a glance (right-click charts to change color!).</p>
                        </div>
                        <div class="csv-info-box">
                            <p><strong>CSV file required in Advanced Mode. Include:</strong></p>
                            <p>â€¢ Product SKUs and names</p>
                            <p>â€¢ Price history (track price changes over time)</p>
                            <p>â€¢ Sales performance data (views, conversions, revenue)</p>
                            <p>â€¢ Custom metadata</p>
                            <p style="margin-top: 10px;"><strong>Note:</strong> Images are optional. Upload images for visual matching, or skip for metadata analysis only.</p>
                        </div>
                        <div class="csv-actions">
                            <div class="file-input-wrapper">
                                <input type="file" id="historicalCsvInput" accept=".csv,.txt" onchange="updateFileLabel(this, 'historicalFileLabel')">
                                <label for="historicalCsvInput" class="file-label">
                                    <span class="file-btn" data-tooltip="Select a CSV file from your computer">CHOOSE FILE</span>
                                    <span class="file-name" id="historicalFileLabel">CSV optional - Use BUILD CSV for easy setup</span>
                                </label>
                            </div>
                            <button type="button" class="btn" onclick="openIntegratedCsvBuilder('historical')" data-tooltip="Open CSV Builder to link existing data or create CSV from scratch">BUILD CSV</button>
                            <button type="button" class="btn" onclick="showCsvHelp('historical')" data-tooltip="View CSV format guide with examples">CSV FORMAT</button>
                        </div>
                        <div class="csv-comparison">
                            <strong>What you get:</strong> Price trend charts â€¢ Sales analytics â€¢ SKU tracking â€¢ Metadata matching â€¢ Detailed reports
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="processHistoricalBtn" disabled>PROCESS</button>
                </div>
                
                <div class="status" id="historicalStatus"></div>
            </section>

            <!-- Step 2: New Products -->
            <section class="section" id="newSection" style="display: none;">
                <div class="section-header">
                    <span class="step">2</span>
                    <h2>NEW PRODUCTS</h2>
                    <div class="mode-toggle" id="newModeToggle">
                        <button class="mode-option active" onclick="setMode('new', 'simple')">SIMPLE</button>
                        <button class="mode-option" onclick="setMode('new', 'advanced')">ADVANCED</button>
                    </div>
                    <button class="help-btn" onclick="toggleHelp('modeHelp2')">?</button>
                </div>
                <div class="help-text" id="modeHelp2" style="display: none; margin-bottom: 20px;">
                    <p><strong>SIMPLE MODE vs ADVANCED MODE:</strong></p>
                    <p><strong>Simple Mode:</strong> Upload images â†’ Visual similarity matching. Fast and easy for quick comparisons.</p>
                    <p><strong>Advanced Mode:</strong> Upload CSV with metadata (required) + optionally images:</p>
                    <p>&nbsp;&nbsp;â€¢ <strong>CSV only:</strong> Metadata analysis (SKU matching, price trends, performance reports)</p>
                    <p>&nbsp;&nbsp;â€¢ <strong>CSV + Images:</strong> Visual matching + Metadata analysis (full business intelligence)</p>
                    <p><strong>Recommendation:</strong> Start with Simple Mode to test. Use Advanced Mode for production workflows with analytics and reporting.</p>
                </div>
                
                <div class="upload-box">
                    <div class="info">
                        <div class="info-header">
                            <strong>TIP:</strong> Put all category folders (placemats, dinnerware, etc.) inside ONE parent folder, then upload that parent folder
                            <button class="help-btn" onclick="toggleHelp('uploadHelp2')">?</button>
                        </div>
                        <div class="help-text" id="uploadHelp2" style="display: none; margin-top: 15px;">
                            <p><strong>HOW TO ORGANIZE YOUR FOLDERS:</strong></p>
                            <p>1. Create a main folder (e.g., "new-products")</p>
                            <p>2. Inside it, create subfolders for each category:</p>
                            <p>&nbsp;&nbsp;&nbsp;â€¢ placemats/</p>
                            <p>&nbsp;&nbsp;&nbsp;â€¢ dinnerware/</p>
                            <p>&nbsp;&nbsp;&nbsp;â€¢ glassware/</p>
                            <p>3. Put product images in their category folders</p>
                            <p>4. Upload the main "new-products" folder</p>
                            <p><strong>NOTE:</strong> Categories help match products more accurately. Products in the same category will be prioritized during matching.</p>
                        </div>
                    </div>
                    
                    <div class="drop-zone" id="newDropZone">
                        <p>DROP ONE FOLDER WITH ALL CATEGORIES</p>
                        <button class="btn" id="newBrowseBtn">BROWSE</button>
                        <input type="file" id="newInput" webkitdirectory directory multiple hidden>
                    </div>
                    
                    <div class="file-info" id="newInfo"></div>
                    
                    <div class="csv-box advanced" id="newCsvBox" style="display: none;">
                        <div class="csv-header">
                            <label>ADVANCED MODE: ADD PRODUCT DETAILS</label>
                            <button class="help-btn" onclick="toggleHelp('advancedHelp2')">?</button>
                        </div>
                        <div class="help-text" id="advancedHelp2" style="display: none; margin-bottom: 20px;">
                            <p><strong>FULL FEATURE SET:</strong></p>
                            <p><strong>Price Tracking:</strong> Upload historical prices to see trend charts (up/down/stable), min/max/average prices, and price change analysis over time.</p>
                            <p><strong>Sales Analytics:</strong> Track sales volume, page views, conversion rates, and revenue. See performance trends and identify top performers.</p>
                            <p><strong>SKU Management:</strong> Assign unique SKUs to products for inventory tracking and cross-referencing with your systems.</p>
                            <p><strong>Product Names:</strong> Add descriptive names for better organization and reporting.</p>
                            <p><strong>Detailed Reports:</strong> Export comprehensive CSV reports with all data, charts, and analytics for further analysis.</p>
                            <p><strong>Visual Charts:</strong> Interactive sparklines and detailed charts show trends at a glance (right-click charts to change color!).</p>
                        </div>
                        <div class="csv-info-box">
                            <p><strong>CSV file required in Advanced Mode. Include:</strong></p>
                            <p>â€¢ Product SKUs and names</p>
                            <p>â€¢ Price history (track price changes over time)</p>
                            <p>â€¢ Sales performance data (views, conversions, revenue)</p>
                            <p>â€¢ Custom metadata</p>
                            <p style="margin-top: 10px;"><strong>Note:</strong> Images are optional. Upload images for visual matching, or skip for metadata analysis only.</p>
                        </div>
                        <div class="csv-actions">
                            <div class="file-input-wrapper">
                                <input type="file" id="newCsvInput" accept=".csv,.txt" onchange="updateFileLabel(this, 'newFileLabel')">
                                <label for="newCsvInput" class="file-label">
                                    <span class="file-btn" data-tooltip="Select a CSV file from your computer">CHOOSE FILE</span>
                                    <span class="file-name" id="newFileLabel">CSV optional - Use BUILD CSV for easy setup</span>
                                </label>
                            </div>
                            <button type="button" class="btn" onclick="openIntegratedCsvBuilder('new')" data-tooltip="Open CSV Builder to link existing data or create CSV from scratch">BUILD CSV</button>
                            <button type="button" class="btn" onclick="showCsvHelp('new')" data-tooltip="View CSV format guide with examples">CSV FORMAT</button>
                        </div>
                        <div class="csv-comparison">
                            <strong>What you get:</strong> Price trend charts â€¢ Sales analytics â€¢ SKU tracking â€¢ Metadata matching â€¢ Detailed reports
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="processNewBtn" disabled>PROCESS</button>
                </div>
                
                <div class="status" id="newStatus"></div>
            </section>

            <!-- Step 3: Match -->
            <section class="section" id="matchSection" style="display: none;">
                <div class="section-header">
                    <span class="step">3</span>
                    <h2>FIND MATCHES</h2>
                </div>
                
                <div class="controls">
                    <div class="control">
                        <label>THRESHOLD: <span id="thresholdValue">50</span>%</label>
                        <input type="range" id="thresholdSlider" min="0" max="100" value="50" data-tooltip="Minimum similarity score. Higher = only very similar products. Lower = more matches but less similar.">
                    </div>
                    
                    <div class="control">
                        <label>MAX MATCHES:</label>
                        <select id="limitSelect" data-tooltip="Maximum number of similar products to show for each new product">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    
                    <div class="control">
                        <button class="btn" id="advancedSettingsBtn" data-tooltip="Adjust color, shape, and texture weights for matching algorithm">ADVANCED</button>
                    </div>
                    
                    <button class="btn btn-primary" id="matchBtn" data-tooltip="Compare new products against historical catalog to find similar items">START MATCHING</button>
                </div>
                
                <!-- Advanced Settings -->
                <div class="advanced" id="advancedSettings" style="display: none;">
                    
                    <!-- Mode 1: Visual Matching (Simple Mode) - CLIP embeddings, no weight tuning needed -->
                    <div id="visualWeightsSection">
                        <h4>VISUAL SIMILARITY (CLIP AI)
                            <button class="help-btn" onclick="toggleHelp('clipHelp')">?</button>
                        </h4>
                        <div class="help-text" id="clipHelp" style="display: none; margin-bottom: 20px;">
                            <p><strong>WHAT IS CLIP?</strong></p>
                            <p>CLIP (Contrastive Language-Image Pre-training) is an AI model that understands images at a deep level, providing superior accuracy compared to traditional methods.</p>
                            <p><strong>CLIP vs Legacy Features:</strong></p>
                            <p>â€¢ <strong>CLIP:</strong> 512-dimensional AI embeddings, holistic understanding, 94% accuracy</p>
                            <p>â€¢ <strong>Legacy:</strong> Color histograms + shape + texture, 78% accuracy</p>
                            <p><strong>Performance:</strong></p>
                            <p>â€¢ CPU: 5-20 images/sec</p>
                            <p>â€¢ GPU (NVIDIA/AMD): 150-300 images/sec</p>
                            <p>â€¢ Apple Silicon: 50-150 images/sec</p>
                            <p><strong>First Run:</strong> CLIP model downloads automatically (~350MB, takes 1-2 minutes). After that, it's cached locally and loads instantly.</p>
                        </div>
                        <div class="info" style="margin: 15px 0;">
                            <p><strong>Using CLIP AI model for visual matching.</strong></p>
                            <p>CLIP automatically analyzes color, shape, texture, and patterns in a single unified embedding.</p>
                            <p>No manual weight tuning needed - the AI handles it!</p>
                        </div>
                    </div>
                    
                    <!-- Mode 2: Metadata Weights (Advanced Mode - CSV Only) -->
                    <div id="metadataWeightsSection" style="display: none;">
                        <h4>METADATA MATCHING WEIGHTS</h4>
                        
                        <div class="weights">
                            <div class="weight">
                                <label>SKU SIMILARITY: <span id="skuWeightValue">30</span>%</label>
                                <input type="range" id="skuWeightSlider" min="0" max="100" value="30">
                            </div>
                            
                            <div class="weight">
                                <label>NAME SIMILARITY: <span id="nameWeightValue">25</span>%</label>
                                <input type="range" id="nameWeightSlider" min="0" max="100" value="25">
                            </div>
                            
                            <div class="weight">
                                <label>CATEGORY MATCH: <span id="categoryWeightValue">20</span>%</label>
                                <input type="range" id="categoryWeightSlider" min="0" max="100" value="20">
                            </div>
                            
                            <div class="weight">
                                <label>PRICE RANGE: <span id="priceWeightValue">15</span>%</label>
                                <input type="range" id="priceWeightSlider" min="0" max="100" value="15">
                            </div>
                            
                            <div class="weight">
                                <label>PERFORMANCE: <span id="performanceWeightValue">10</span>%</label>
                                <input type="range" id="performanceWeightSlider" min="0" max="100" value="10">
                            </div>
                        </div>
                        
                        <div class="weight-total">
                            TOTAL: <span id="metadataWeightTotal">100</span>% <span id="metadataWeightWarning" style="display: none;">âš  MUST = 100%</span>
                        </div>
                    </div>
                    
                    <!-- Mode 3: Hybrid Weights (Advanced Mode - Images + CSV) -->
                    <div id="hybridWeightsSection" style="display: none;">
                        <h4>HYBRID MATCHING WEIGHTS</h4>
                        
                        <div class="weights">
                            <div class="weight">
                                <label>VISUAL MATCHING: <span id="hybridVisualWeightValue">60</span>%</label>
                                <input type="range" id="hybridVisualWeightSlider" min="0" max="100" value="60">
                            </div>
                            
                            <div class="weight">
                                <label>METADATA MATCHING: <span id="hybridMetadataWeightValue">40</span>%</label>
                                <input type="range" id="hybridMetadataWeightSlider" min="0" max="100" value="40">
                            </div>
                        </div>
                        
                        <div class="weight-total">
                            TOTAL: <span id="hybridWeightTotal">100</span>% <span id="hybridWeightWarning" style="display: none;">âš  MUST = 100%</span>
                        </div>
                        
                        <!-- Visual matching uses CLIP - no sub-weights needed -->
                        <div class="info" style="margin-top: 20px; padding: 15px; border: 2px solid #000; background: #f9f9f9;">
                            <p><strong>Visual Component: CLIP AI</strong></p>
                            <p>CLIP automatically analyzes all visual features (color, shape, texture, patterns) in a unified embedding. No manual tuning required!</p>
                        </div>
                        
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; font-weight: bold; padding: 10px; background: #f0f0f0; border: 2px solid #000;">
                                METADATA SUB-WEIGHTS â–¼
                            </summary>
                            <div style="padding: 15px; border: 2px solid #000; border-top: none;">
                                <div class="weights">
                                    <div class="weight">
                                        <label>SKU: <span id="hybridSkuWeightValue">30</span>%</label>
                                        <input type="range" id="hybridSkuWeightSlider" min="0" max="100" value="30">
                                    </div>
                                    
                                    <div class="weight">
                                        <label>NAME: <span id="hybridNameWeightValue">25</span>%</label>
                                        <input type="range" id="hybridNameWeightSlider" min="0" max="100" value="25">
                                    </div>
                                    
                                    <div class="weight">
                                        <label>CATEGORY: <span id="hybridCategoryWeightValue">20</span>%</label>
                                        <input type="range" id="hybridCategoryWeightSlider" min="0" max="100" value="20">
                                    </div>
                                    
                                    <div class="weight">
                                        <label>PRICE: <span id="hybridPriceWeightValue">15</span>%</label>
                                        <input type="range" id="hybridPriceWeightSlider" min="0" max="100" value="15">
                                    </div>
                                    
                                    <div class="weight">
                                        <label>PERFORMANCE: <span id="hybridPerformanceWeightValue">10</span>%</label>
                                        <input type="range" id="hybridPerformanceWeightSlider" min="0" max="100" value="10">
                                    </div>
                                </div>
                                <div class="weight-total">
                                    TOTAL: <span id="hybridMetadataSubWeightTotal">100</span>% <span id="hybridMetadataSubWeightWarning" style="display: none;">âš  MUST = 100%</span>
                                </div>
                            </div>
                        </details>
                    </div>
                    
                    <button class="btn" id="resetWeightsBtn" style="margin-top: 20px;">RESET</button>
                </div>
                
                <div class="progress" id="matchProgress"></div>
            </section>

            <!-- Step 4: Results -->
            <section class="section" id="resultsSection" style="display: none;">
                <div class="section-header">
                    <h2>RESULTS</h2>
                    <div class="actions">
                        <button class="btn" id="exportCsvBtn" data-tooltip="Export match results to CSV file with all data">CSV</button>
                        <button class="btn" id="exportWithImagesBtn" data-tooltip="Export results with images in a ZIP file">EXPORT+IMG</button>
                        <button class="btn" id="duplicateReportBtn" data-tooltip="Show products with >90% similarity (potential duplicates)">DUPLICATES</button>
                        <button class="btn" id="saveSessionBtn" data-tooltip="Save current session to continue later">SAVE</button>
                        <button class="btn" id="loadSessionBtn" data-tooltip="Load a previously saved session">LOAD</button>
                        <button class="btn" id="resetBtn" data-tooltip="Clear all data and start over">RESET</button>
                    </div>
                </div>
                
                <!-- Filters -->
                <div class="filters">
                    <input type="text" id="searchInput" placeholder="SEARCH..." class="input">
                    
                    <select id="categoryFilter" class="select">
                        <option value="all">ALL CATEGORIES</option>
                    </select>
                    
                    <select id="sortBySelect" class="select">
                        <option value="similarity">SIMILARITY</option>
                        <option value="price">PRICE</option>
                        <option value="performance">PERFORMANCE</option>
                        <option value="name">NAME</option>
                    </select>
                    
                    <label>
                        <input type="checkbox" id="duplicatesOnlyCheckbox">
                        DUPLICATES ONLY
                    </label>
                    
                    <button class="btn" id="clearFiltersBtn">CLEAR</button>
                </div>
                
                <div class="summary" id="resultsSummary"></div>
                <div class="results" id="resultsList"></div>
            </section>
        </main>
    </div>

    <div id="toast" class="toast"></div>
    
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="modalClose">Ã—</span>
            <div id="modalBody"></div>
        </div>
    </div>
    
    <div id="csvHelpModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeCsvHelp()" data-tooltip="Close this window">Ã—</span>
            <div id="csvHelpBody">
                <h2>CSV FORMAT GUIDE</h2>
                
                <div class="csv-download">
                    <button class="btn" onclick="window.open('/csv-builder', '_blank')" data-tooltip="Open interactive tool to build CSV with step-by-step guidance">OPEN CSV BUILDER</button>
                    <button class="btn" onclick="downloadSampleCsv()" data-tooltip="Download a sample CSV file with example data to use as a template">DOWNLOAD TEMPLATE</button>
                    <p><strong>Don't have a CSV?</strong> Use the CSV Builder to create one! It can link your existing product data to images automatically.</p>
                    <p>The CSV Builder supports multiple workflows: import existing data, export template to fill in Excel, or enter manually.</p>
                </div>
                
                <div class="format-box">
                    <div class="format-header">
                        <h3>1. BASIC FORMAT</h3>
                        <button class="help-btn" onclick="toggleHelp('help1')">?</button>
                    </div>
                    <div class="help-text" id="help1" style="display: none;">
                        <p><strong>HOW TO FORMAT:</strong></p>
                        <p>â€¢ First row: Column headers (filename, category, sku, name)</p>
                        <p>â€¢ Each row after: One product per line</p>
                        <p>â€¢ Separate columns with commas</p>
                        <p>â€¢ Filename must match your image file exactly</p>
                        <p>â€¢ Category can be left blank if using folder structure</p>
                    </div>
                    <pre>filename,category,sku,name
product1.jpg,placemats,PM-001,Blue Placemat
product2.jpg,dinnerware,DW-002,White Plate</pre>
                </div>
                
                <div class="format-box">
                    <div class="format-header">
                        <h3>2. WITH CURRENT PRICE</h3>
                        <button class="help-btn" onclick="toggleHelp('help2')">?</button>
                    </div>
                    <div class="help-text" id="help2" style="display: none;">
                        <p><strong>HOW TO FORMAT:</strong></p>
                        <p>â€¢ Add "price" column header</p>
                        <p>â€¢ Enter price as decimal number (e.g., 29.99)</p>
                        <p>â€¢ Don't include currency symbols ($, â‚¬, etc.)</p>
                        <p>â€¢ Use period (.) for decimal separator</p>
                    </div>
                    <pre>filename,category,sku,name,price
product1.jpg,placemats,PM-001,Blue Placemat,29.99
product2.jpg,dinnerware,DW-002,White Plate,45.00</pre>
                </div>
                
                <div class="format-box">
                    <div class="format-header">
                        <h3>3. WITH PRICE HISTORY</h3>
                        <button class="help-btn" onclick="toggleHelp('help3')">?</button>
                    </div>
                    <div class="help-text" id="help3" style="display: none;">
                        <p><strong>HOW TO FORMAT:</strong></p>
                        <p>â€¢ Add "price_history" column header</p>
                        <p>â€¢ Format each entry as: YYYY-MM-DD:price</p>
                        <p>â€¢ Separate multiple entries with semicolons (;)</p>
                        <p>â€¢ Example: 2024-01-15:29.99;2024-02-15:31.50</p>
                        <p>â€¢ Maximum 12 months of history</p>
                        <p>â€¢ Dates must be in YYYY-MM-DD format</p>
                    </div>
                    <pre>filename,category,sku,name,price_history
product1.jpg,placemats,PM-001,Blue Placemat,2024-01-15:29.99;2024-02-15:31.50;2024-03-15:28.75</pre>
                </div>
                
                <div class="format-box">
                    <div class="format-header">
                        <h3>4. WITH PERFORMANCE DATA</h3>
                        <button class="help-btn" onclick="toggleHelp('help4')">?</button>
                    </div>
                    <div class="help-text" id="help4" style="display: none;">
                        <p><strong>HOW TO FORMAT:</strong></p>
                        <p>â€¢ Add "performance_history" column header</p>
                        <p>â€¢ Format: date:sales:views:conversion:revenue</p>
                        <p>â€¢ Separate multiple entries with semicolons (;)</p>
                        <p>â€¢ Example breakdown:</p>
                        <p>&nbsp;&nbsp;- Date: 2024-01-15</p>
                        <p>&nbsp;&nbsp;- Sales: 150 (number of units sold)</p>
                        <p>&nbsp;&nbsp;- Views: 1200 (page views)</p>
                        <p>&nbsp;&nbsp;- Conversion: 12.5 (percentage, no % symbol)</p>
                        <p>&nbsp;&nbsp;- Revenue: 1800 (total revenue, no $ symbol)</p>
                        <p>â€¢ Full entry: 2024-01-15:150:1200:12.5:1800</p>
                    </div>
                    <pre>filename,category,sku,name,price,performance_history
product1.jpg,placemats,PM-001,Blue Placemat,29.99,2024-01-15:150:1200:12.5:1800</pre>
                </div>
                
                <div class="notes">
                    <h3>IMPORTANT NOTES</h3>
                    <ul>
                        <li><strong>FILENAME is the only required field</strong> - this is how we link images to metadata</li>
                        <li>CATEGORY is auto-detected from folder structure if not provided</li>
                        <li>Use SEMICOLONS (;) to separate multiple history entries</li>
                        <li>Maximum 12 months of history data</li>
                        <li>All other fields are optional</li>
                        <li><strong>Flexible formats supported:</strong> Column order doesn't matter, extra columns are ignored</li>
                        <li><strong>Already have product data?</strong> Use CSV Builder's linking feature to match it to your images</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
